#include QMK_KEYBOARD_H

enum custom_layer {
    _BASE,
    _SHIFT,
    _NAV,
    _NUM,
    _SYM,
    _BOOT
};

enum custom_keycodes {
    CKC_A = SAFE_RANGE,
    CKC_S, CKC_D, CKC_F, CKC_J, CKC_K, CKC_L, CKC_SCLN,
    CKC_LB,  // LOPT(KC_BSPC)
    CKC_LD,  // LOPT(KC_DEL)
};

#include "sm_td.h"

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

/* _BASE Layout:
┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
   ESC      1        LCTL     LOPT    LGUI      5                                  6        RGUI     ROPT     RCTL     0       BSPC
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
   TAB      Q        W        E        R        T                                  Y        U        I        O        P       DEL
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
   ENT      A/NAV    S/CTL    D/OPT    F/GUI    G                                  H        J/GUI    K/OPT    L/CTL    ;/NAV   '
├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
   LSFT     Z        X        C        V        B      LOPT(BSPC)        LOPT(DEL) N        M        ,        .        /       RSFT
└────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                  ENT      BSPC      SPC                       SPC       BSPC     ENT
                               └────────┴────────┴────────┘                 └────────┴────────┴────────┘
*/

[_BASE] = LAYOUT(
  KC_ESC,  KC_1,    KC_LCTL, KC_LOPT, KC_LGUI, KC_5,                                KC_6,    KC_RGUI, KC_ROPT, KC_RCTL, KC_0,    KC_BSPC,
  KC_TAB,  KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                                KC_Y,    KC_U,    KC_I,    KC_O,    KC_P,    KC_DEL,
  KC_ENT,  CKC_A,   CKC_S,   CKC_D,   CKC_F,   KC_G,                                KC_H,    CKC_J,   CKC_K,   CKC_L,   CKC_SCLN, KC_QUOT,
  LSFT_T(MO(_SHIFT)), KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,  CKC_LB,    CKC_LD,  KC_N,    KC_M,    KC_COMM, KC_DOT,  KC_SLSH, RSFT_T(MO(_SHIFT)),
  KC_ENT,  LT(_SYM, KC_BSPC), LT(_NUM, KC_SPC),                                       LT(_NUM, KC_SPC), LT(_SYM, KC_BSPC), KC_ENT
),

/* _SHIFT Layout:
┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
 _______    1        2        3        4        5                                  6        7        8        9        0       _______
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
   TAB      Q        W        E        R        T                                  Y        U        I        O        P       _______
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
   ENT      A        S        D        F        G                                  H        J        K        L        ;       "
├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
  XXXXXX    Z        X        C        V        B       _______           _______  N        M        ,        .        /        XXXXXX
└────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                  ENT      BSPC      SPC                       SPC       BSPC     ENT
                               └────────┴────────┴────────┘                 └────────┴────────┴────────┘
*/

[_SHIFT] = LAYOUT(
  _______, LSFT(KC_1), LSFT(KC_2), LSFT(KC_3), LSFT(KC_4), LSFT(KC_5),                 LSFT(KC_6), LSFT(KC_7), LSFT(KC_8), LSFT(KC_9), LSFT(KC_0), _______,
  LSFT(KC_TAB), LSFT(KC_Q), LSFT(KC_W), LSFT(KC_E), LSFT(KC_R), LSFT(KC_T),            LSFT(KC_Y), LSFT(KC_U), LSFT(KC_I), LSFT(KC_O), LSFT(KC_P), _______,
  LSFT(KC_ENT), LSFT(KC_A), LSFT(KC_S), LSFT(KC_D), LSFT(KC_F), LSFT(KC_G),            LSFT(KC_H), LSFT(KC_J), LSFT(KC_K), LSFT(KC_L), LSFT(KC_SCLN), LSFT(KC_QUOT),
  _______, LSFT(KC_Z), LSFT(KC_X), LSFT(KC_C), LSFT(KC_V), LSFT(KC_B), _______,      _______, LSFT(KC_N), LSFT(KC_M), LSFT(KC_COMM), LSFT(KC_DOT), LSFT(KC_SLSH), _______,
  LSFT(KC_ENT), LSFT(KC_BSPC), LSFT(KC_SPC),                                           LSFT(KC_SPC), LSFT(KC_BSPC), LSFT(KC_ENT)
),

/* _NAV Layout: I think this will be the A and ; keys
┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
 _______  _______   _______  _______  _______  _______                            _______   _______  _______  _______  _______  _______
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
  _______  _______ OPT+Left   Up     OPT+Right  Home                               Home     OPT+Left  Up     OPT+Right _______  _______
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
 _______   XXXXXX   Right    Down     Left      End                                End      Left      Down    Right    XXXXXX   _______
├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
 _______   _______  _______  _______  _______  _______  _______          _______   _______ _______   _______  _______  _______  _______
└────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                 _______  _______  _______                    _______ _______   _______
                               └────────┴────────┴────────┘                 └────────┴────────┴────────┘
*/

[_NAV] = LAYOUT(
  _______, _______, _______, _______, _______, _______,                            _______, _______, _______, _______, _______, _______,
  _______, _______, LOPT(KC_LEFT), KC_UP, LOPT(KC_RGHT), KC_HOME,                  KC_HOME, LOPT(KC_LEFT), KC_UP, LOPT(KC_RGHT), _______, _______,
  _______, _______, KC_RGHT, KC_DOWN, KC_LEFT, KC_END,                             KC_END, KC_LEFT, KC_DOWN, KC_RGHT, _______, _______,
  _______, _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
  _______, _______, _______,                                                       _______, _______, _______
),

/* _NUM Layout: I think this will be the 3rd Thumb key
┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
 _______  _______   _______  _______  _______  _______                            _______   _______  _______  _______  _______  _______
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
  _______  !        @        #        $        %                                   ^        &        *        (        )        _______
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
 _______   1        2        3        4        5                                   6        7        8        9        0        _______
├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
 _______   _______  _______  _______  _______  _______  _______          _______   _______ _______   _______  _______  _______  _______
└────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                 _______  _______  XXXXXX                    XXXXXX _______   _______
                               └────────┴────────┴────────┘                 └────────┴────────┴────────┘
*/

[_NUM] = LAYOUT(
  _______, _______, _______, _______, _______, _______,                            _______, _______, _______, _______, _______, _______,
  _______, LSFT(KC_1), LSFT(KC_2), LSFT(KC_3), LSFT(KC_4), LSFT(KC_5),             LSFT(KC_6), LSFT(KC_7), LSFT(KC_8), LSFT(KC_9), LSFT(KC_0), _______,
  _______, KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                               KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    _______,
  _______, _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
  _______, _______, _______,                                                       _______, _______, _______
),

/* _SYM Layer: I think this will be the 2nd Thumb key
┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
   ~       _______  _______  _______  _______  _______                             _______  _______  _______  _______  _______  ~
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
   `        {        }        [        ]        +                                  +        [        ]        {        }        `
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
   "        '       _______   _        |        -                                  -        |        _        _______  '        "
├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
 _______   _______  _______  _______   \        =       _______           _______  =        \        _______  _______  _______  _______
└────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                  ENT     _______  SPC                       SPC       _______  ENT
                               └────────┴────────┴────────┘                 └────────┴────────┴────────┘
*/

[_SYM] = LAYOUT(
  LSFT(KC_GRV), _______, _______, _______, _______, _______,                       _______, _______, _______, _______, _______, LSFT(KC_GRV),
  KC_GRV,  LSFT(KC_LBRC), LSFT(KC_RBRC), KC_LBRC, KC_RBRC, KC_PLUS,              KC_PLUS, KC_LBRC, KC_RBRC, LSFT(KC_LBRC), LSFT(KC_RBRC), KC_GRV,
  LSFT(KC_QUOT), KC_QUOT, _______, KC_UNDS, LSFT(KC_BSLS), KC_MINS,              KC_MINS, LSFT(KC_BSLS), KC_UNDS, _______, KC_QUOT, LSFT(KC_QUOT),
  _______, _______, _______, _______, KC_BSLS, KC_EQL, _______,          _______, KC_EQL, KC_BSLS, _______, _______, _______, _______,
  KC_ENT,  _______,  KC_SPC,                                                     KC_SPC,  _______,  KC_ENT
),

/* _BOOT Layout:
┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
   SLEP    _______  _______  _______  _______  BOOT                               RGB_TOG  _______  _______  _______  _______  BOOT
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
  _______  _______ S(C(A(LEFT))) C(A(UP)) S(C(A(RIGHT))) _______                  RGB_VAI  _______  _______  _______  _______  _______
├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
  _______  _______ C(A(LEFT)) C(A(DOWN)) C(A(RIGHT)) _______                     RGB_VAD  _______  _______  _______  _______  _______
├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
  _______  _______  _______  _______  _______  _______  _______         _______  _______  _______  _______  _______  _______  _______
└────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                               _______  _______  _______                   _______  _______  _______
                               └────────┴────────┴────────┘                 └────────┴────────┴────────┘
*/

[_BOOT] = LAYOUT(
  KC_SLEP, _______, _______, _______, _______, QK_BOOT,                              RGB_TOG, _______, _______, _______, _______, QK_BOOT,
  _______, _______, S(C(A(KC_LEFT))), C(A(KC_UP)), S(C(A(KC_RIGHT))), _______,       RGB_VAI, _______, _______, _______, _______, _______,
  _______, _______, C(A(KC_LEFT)), C(A(KC_DOWN)), C(A(KC_RIGHT)), _______,           RGB_VAD, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______, _______,            _______, _______, _______, _______, _______, _______, _______,
  _______, _______, _______,                                                         _______, _______, _______
),
};

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    if (!process_smtd(keycode, record)) {
        return false;
    }
    return true;
}

void on_smtd_action(uint16_t keycode, smtd_action action, uint8_t tap_count) {
    switch (keycode) {
        // Mod-tap behaviors for modifiers
        SMTD_MT_ON_MKEY(CKC_S, KC_S, KC_LCTL)
        SMTD_MT_ON_MKEY(CKC_D, KC_D, KC_LOPT)
        SMTD_MT_ON_MKEY(CKC_F, KC_F, KC_LGUI)
        SMTD_MT_ON_MKEY(CKC_J, KC_J, KC_RGUI)
        SMTD_MT_ON_MKEY(CKC_K, KC_K, KC_ROPT)
        SMTD_MT_ON_MKEY(CKC_L, KC_L, KC_RCTL)
        
        // Layer-tap behaviors for _NAV layer
        SMTD_LT_ON_MKEY(CKC_A, KC_A, _NAV)
        SMTD_LT_ON_MKEY(CKC_SCLN, KC_SCLN, _NAV)
        
        // Layer-tap behaviors for _BOOT layer with LOPT combos
        SMTD_LT_ON_MKEY(CKC_LB, LOPT(KC_BSPC), _BOOT)
        SMTD_LT_ON_MKEY(CKC_LD, LOPT(KC_DEL), _BOOT)
    }
}